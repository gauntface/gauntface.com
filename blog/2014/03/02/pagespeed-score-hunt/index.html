<!DOCTYPE html><html lang="en"><head>
  <title>Pagespeed Score Hunt</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="Description" content="This is the site description"/>
  <meta name="theme-color" content="#565797"/>
<style>h1{font-weight:400;font-size:2rem}</style><style>img{max-width:100%;height:auto}</style><style>.c-footer{display:flex;flex-direction:row;justify-content:center}.c-footer__content{padding:var(--footer-padding)}.c-footer a{text-decoration:none}</style><style>a{color:inherit}</style><style>.c-header{color:var(--platnum);padding:var(--header-padding) var(--page-padding);background:var(--dark-grey)}.c-header__logo svg{width:124px;height:124px;margin:auto}.c-header__logo svg path{fill:var(--white)}</style><style>code{padding:0 var(--inline-code-padding);border-radius:var(--inline-code-padding);font-family:var(--code-font-family);background:var(--dark-grey);color:var(--white)}</style><style>:root{--body-font-family:"Roboto",sans-serif;--code-font-family:"dm",monospace;--default-font-size:18px;--table-cell-padding:8px;--page-padding:24px;--header-padding:64px;--footer-padding:64px;--inline-code-padding:4px;--pre-padding:4px;--page-max-width:800px;--white:#f5f6fa;--dark-grey:#2f3640}html{height:100%;font-size:18px;font-size:var(--default-font-size)}</style><style>h2{font-weight:400;font-size:1.7rem}</style><style>pre{overflow-x:auto}</style><style>pre{background-color:var(--dark-grey);padding:var(--pre-padding);border-radius:var(--pre-padding);overflow-x:auto;box-shadow:0 2px 8px var(--drop-shadow)}pre code{padding:0;background:unset}</style><style>svg{display:block}</style><style>p{word-wrap:break-word}</style><style>@import url("https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap");body{display:inline;min-height:100%;font-family:var(--body-font-family);background:var(--white);color:var(--dark-grey);margin:0}</style><style>.l-default{display:flex;flex-direction:column;min-height:100%}.l-default__main{max-width:var(--page-max-width);margin:0 auto;flex:1;padding:var(--page-padding)}</style></head><body>
<div class="l-default">
  <header class="c-header">
  <a href="/" class="c-header__logo">
    <svg width="1024" height="1024" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M988 36H36V987H988V36ZM0 0V1023H1024V0H0Z" fill="black"></path>
<path d="M834.787 519.358H767.661V590H746.567V430.039H845.664V447.397H767.661V502.109H834.787V519.358Z" fill="black"></path>
<path d="M574.089 447.397H522.673V590H501.689V447.397H450.383V430.039H574.089V447.397Z" fill="black"></path>
<path d="M834.984 821.062H765.661V877.751H846.19V895H744.567V735.039H845.092V752.397H765.661V803.813H834.984V821.062Z" fill="black"></path>
<path d="M575.23 844.243C573.253 861.162 566.991 874.236 556.444 883.464C545.97 892.62 532.018 897.197 514.586 897.197C495.689 897.197 480.528 890.422 469.103 876.873C457.75 863.323 452.074 845.195 452.074 822.49V807.109C452.074 792.241 454.71 779.167 459.984 767.888C465.331 756.609 472.875 747.966 482.616 741.96C492.357 735.881 503.636 732.842 516.454 732.842C533.446 732.842 547.069 737.603 557.323 747.124C567.577 756.572 573.546 769.683 575.23 786.455H554.027C552.196 773.711 548.204 764.482 542.052 758.77C535.973 753.057 527.44 750.2 516.454 750.2C502.977 750.2 492.394 755.181 484.703 765.142C477.086 775.103 473.277 789.275 473.277 807.659V823.149C473.277 840.508 476.903 854.314 484.154 864.568C491.405 874.822 501.549 879.949 514.586 879.949C526.305 879.949 535.277 877.312 541.502 872.039C547.801 866.692 551.976 857.427 554.027 844.243H575.23Z" fill="black"></path>
<path d="M266.397 853.252H199.38L184.329 895H162.576L223.66 735.039H242.117L303.311 895H281.668L266.397 853.252ZM205.752 835.894H260.135L232.889 761.077L205.752 835.894Z" fill="black"></path>
<path d="M294.004 590H272.8L192.271 466.733V590H171.067V430.039H192.271L273.02 553.855V430.039H294.004V590Z" fill="black"></path>
<path d="M848.177 122.039V230.804C848.104 245.892 843.343 258.233 833.895 267.828C824.52 277.422 811.775 282.806 795.662 283.978L790.059 284.197C772.554 284.197 758.602 279.473 748.201 270.025C737.801 260.577 732.527 247.576 732.381 231.023V122.039H753.255V230.364C753.255 241.937 756.441 250.945 762.813 257.391C769.185 263.763 778.267 266.949 790.059 266.949C801.998 266.949 811.116 263.763 817.415 257.391C823.787 251.019 826.973 242.046 826.973 230.474V122.039H848.177Z" fill="black"></path>
<path d="M545.897 240.252H478.88L463.829 282H442.076L503.16 122.039H521.617L582.811 282H561.168L545.897 240.252ZM485.252 222.894H539.635L512.389 148.077L485.252 222.894Z" fill="black"></path>
<path d="M292.17 261.016C286.75 268.78 279.169 274.603 269.428 278.484C259.76 282.293 248.481 284.197 235.59 284.197C222.553 284.197 210.981 281.158 200.874 275.079C190.766 268.926 182.929 260.21 177.363 248.931C171.87 237.652 169.05 224.578 168.903 209.71V195.757C168.903 171.661 174.506 152.984 185.712 139.727C196.992 126.47 212.812 119.842 233.173 119.842C249.873 119.842 263.312 124.126 273.493 132.696C283.674 141.192 289.899 153.277 292.17 168.951H271.076C267.121 147.784 254.523 137.2 233.283 137.2C219.147 137.2 208.417 142.181 201.093 152.142C193.842 162.029 190.18 176.385 190.107 195.208V208.282C190.107 226.226 194.208 240.508 202.412 251.128C210.615 261.675 221.711 266.949 235.7 266.949C243.61 266.949 250.532 266.07 256.464 264.312C262.397 262.554 267.304 259.588 271.186 255.413V219.488H234.162V202.349H292.17V261.016Z" fill="black"></path>
</svg>

  </a>
</header>
  <main class="l-default__main">
<p><img src="/images/blog/2014/05/24/internet-stability.jpg" alt="Key art for blog post “Pagespeed Score Hunt “"/></p>
<h1 id="pagespeed-score-hunt">Pagespeed Score Hunt</h1>
<p>For those who aren&#39;t aware of <a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed insights</a>, it&#39;s a service which will allow you to figure out where you could optimise the load time of your site and well worth checking out <a href="https://developers.google.com/speed/pagespeed/insights/">https://developers.google.com/speed/pagespeed/insights/</a>.</p>
<h1 id="io-byte">IO Byte</h1>
<p>For Google I/O 2014 I put together a video covering a lot of these details, with useful Grunt and Gulp tasks to achieve certain tasks.</p>
<p>If you&#39;re more of a video fan then give this a go, otherwise if you prefer a read, then skip on ahead :)</p>
<!-- raw HTML omitted -->
<h1 id="without-conscious-effort">Without Conscious Effort</h1>
<p>Without doing anything to improve my <a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed</a> score, I was sitting at 89/100 for desktop and 83/100 for mobile. Two things to note here:</p>
<ol>
<li>This isn&#39;t a finished site (it&#39;s barely even a site) so may degrade as soon as the content grows</li>
<li>The only reason I&#39;m looking at it early is to try and automate as much as possible for the rest of the development process</li>
</ol>
<p>Let&#39;s look at the issues on desktop, see how I can fix them (if I can), and then see how that affects the mobile score.</p>
<h1 id="desktop-issues">Desktop Issues</h1>
<h2 id="leverage-browser-caching">Leverage Browser Caching</h2>
<p>To fix this I grabbed a copy of the htaccess file from <a href="http://html5boilerplate.com">HTML5 Boilerplate</a>. If you haven&#39;t dug around in the htacces file before, now is the time, its full of useful tips.</p>
<p>This one change, gave me a big huge boost in score.</p>
<p><img src="/images/blog/2014/03/Screenshot-from-2014-03-01-104610.png" alt="PageSpeed Insights Score With Caching"/></p>
<p>So what exactly is in the .htaccess file which is making this magical change?</p>
<pre><code># ------------------------------------------------------------------------------
# | Expires headers                                                            |
# ------------------------------------------------------------------------------

# The following expires headers are set pretty far in the future. If you
# don&#39;t control versioning with filename-based cache busting, consider
# lowering the cache time for resources such as style sheets and JavaScript
# files to something like one week.

&lt;IfModule mod_expires.c&gt;

    ExpiresActive on
    ExpiresDefault                                      &#34;access plus 1 month&#34;

  # CSS
    ExpiresByType text/css                              &#34;access plus 1 year&#34;

  # Data interchange
    ExpiresByType application/json                      &#34;access plus 0 seconds&#34;
    ExpiresByType application/ld+json                   &#34;access plus 0 seconds&#34;
    ExpiresByType application/xml                       &#34;access plus 0 seconds&#34;
    ExpiresByType text/xml                              &#34;access plus 0 seconds&#34;

  # Favicon (cannot be renamed!) and cursor images
    ExpiresByType image/x-icon                          &#34;access plus 1 week&#34;

  # HTML components (HTCs)
    ExpiresByType text/x-component                      &#34;access plus 1 month&#34;

  # HTML
    ExpiresByType text/html                             &#34;access plus 0 seconds&#34;

  # JavaScript
    ExpiresByType application/javascript                &#34;access plus 1 year&#34;

  # Manifest files
    ExpiresByType application/x-web-app-manifest+json   &#34;access plus 0 seconds&#34;
    ExpiresByType text/cache-manifest                   &#34;access plus 0 seconds&#34;

  # Media
    ExpiresByType audio/ogg                             &#34;access plus 1 month&#34;
    ExpiresByType image/gif                             &#34;access plus 1 month&#34;
    ExpiresByType image/jpeg                            &#34;access plus 1 month&#34;
    ExpiresByType image/png                             &#34;access plus 1 month&#34;
    ExpiresByType video/mp4                             &#34;access plus 1 month&#34;
    ExpiresByType video/ogg                             &#34;access plus 1 month&#34;
    ExpiresByType video/webm                            &#34;access plus 1 month&#34;

  # Web feeds
    ExpiresByType application/atom+xml                  &#34;access plus 1 hour&#34;
    ExpiresByType application/rss+xml                   &#34;access plus 1 hour&#34;

  # Web fonts
    ExpiresByType application/font-woff                 &#34;access plus 1 month&#34;
    ExpiresByType application/vnd.ms-fontobject         &#34;access plus 1 month&#34;
    ExpiresByType application/x-font-ttf                &#34;access plus 1 month&#34;
    ExpiresByType font/opentype                         &#34;access plus 1 month&#34;
    ExpiresByType image/svg+xml                         &#34;access plus 1 month&#34;

&lt;/IfModule&gt;
</code></pre><p>Each rule basically defines an expiration time depending on the file type.</p>
<p>The important thing to take note of is the comment on cache busting.</p>
<p>Ultimately you want to change the filename whenever there is a new version of a file (CSS, JS etc). The sanest way I can think of is to make use of <a href="https://github.com/cbas/grunt-rev">grunt-rev</a> along with <a href="https://github.com/yeoman/grunt-usemin">grunt-usemin</a> (Note: <a href="http://yeoman.io/">Yeoman</a> uses this in it&#39;s default build process, plus if a better tool comes out, chances are it&#39;ll be in <a href="http://yeoman.io/">Yeoman&#39;s</a> webapp generator).</p>
<p>The grunt-rev task can achieve this, the difficult part was getting the PHP templates to update to the new revisioned name.</p>
<p>I&#39;ve put a few things in place to try and handle this, but it&#39;s far from pretty and needs further work. At least it&#39;s there.</p>
<h2 id="optimise-images">Optimise Images</h2>
<p>I have a bit of a weird set-up with my images, I&#39;ve adapted a small back-end script to resize images when requested based on the image name, see <a href="/2014/02/16/new-site-new-approach/">this post for more info</a>.</p>
<p>The main topic of concern for page speed is the compression used for these images, initially my head thought of compression as equivalent to quality, i.e. lower the quality, the file size goes down, everyone is happy. So you can imagine my surprise when my PageSpeed score started to fall as I reduced the file size.</p>
<p>That&#39;s when I actually took the time to read the manual for the optimizations <a href="https://developers.google.com/speed/docs/insights/OptimizeImages">https://developers.google.com/speed/docs/insights/OptimizeImages</a>.</p>
<p>Compression != Quality.</p>
<p>Obvious when you think about it, and they suggest stripping out the meta data for your jpegs with jpegoptim.</p>
<p>This was a bit of a blow, my images are auto-generated on the server side such that I can throw image requests with specific name formats and the server will create the required image (i.e. attempt to be a good citizen for smaller screen devices). The problem is that with this approach, I can&#39;t strip out the meta data server side. The original images I use to resize, don&#39;t seem to benefit from stripping out meta data.</p>
<p>I could upload pre-sized images but the problem with this is that it still won&#39;t cover uploaded images used in a blog type scenario.</p>
<p>Will have to revisit.</p>
<h2 id="eliminate-render-blocking-js-and-css">Eliminate Render-Blocking JS and CSS</h2>
<p>All my javascript is at the bottom of the page, so this was exclusively an issue with the CSS, so as a quick test, I copied and pasted the css into the html.</p>
<p><img src="/images/blog/2014/03/Screenshot-from-2014-03-01-170406.png" alt="Pagespeed with Inlined CSS"/></p>
<p>Boom.</p>
<p>Using <a href="http://www.webpagetest.org/">http://www.webpagetest.org/</a> I had a look on the impact of this change and the results weren’t too shocking. The initial load was generally a bit faster by a small amount, where as the second reload would be ever so slightly longer (about 130ms).</p>
<p>Pretty much puts me on the fence regarding whether inline CSS is worth it, given the amount of caching which is then lost, which <a href="http://aerotwist.com">Paul Lewis</a> pointed out to me.</p>
<h2 id="inline-svg">Inline SVG</h2>
<p>This was an interesting one, I like inlining SVG as it means you can style elements with CSS if you wanted to, but the other benefit of it, is that it means one less request to your server. The obvious down side is that it makes your HTML page larger.</p>
<p>Back to <a href="http://www.webpagetest.org/">http://www.webpagetest.org/</a>, the initial load time went <strong>down</strong> by approximately <strong>100-200 milliseconds</strong> where as the repeat load had some mixed up and and downs depending on the metric, so all in all I think the trade-off is good to inline, but perhaps just play around for your use case.</p>
<h2 id="the-pointless-stat---caching-html">The Pointless Stat - Caching HTML</h2>
<p>The biggest criticism of putting CSS inline is that you lose caching of the CSS file and specifically caching of shared CSS files across your site – Boooooo.</p>
<p>If you do have a static site however, perhaps caching the HTML is an option and if it is, then you can always switch it on and speed up the load times considerably for repeat loads. (I’m currently trialling this out to see how my site load times appear on analytics).</p>
<h1 id="get-it-in-your-workflow">Get it in your Workflow</h1>
<p>To be honest, I am to lazy to repeatedly go back and forth on the PageSpeed site, I want to be able to hit refresh and see how my score is doing, this is where <a href="http://paul.kinlan.me">Paul Kinlan’s</a> Chrome extension comes in handy: <a href="https://chrome.google.com/webstore/detail/pagespeed-insights-checke/mkjmodmicmpjedhoekkmafdgpocdkbna?utm_source=chrome-ntp-icon">PageSpeed Insights Checker</a>.</p>
<p>The one thing I would recommend is adding your own API key to the extension, just right click on the extension icon and select <strong>Options</strong>. Then click the <strong>API Key</strong> link, go to <strong>APIs &amp; auth</strong> for a suitable project (I ended up just creating a new one for my site), under API’s search for <strong>PageSpeed Insights API</strong> and turn it on.</p>
<p><img src="/images/blog/2014/03/Screenshot-from-2014-03-01-101134.png" alt="Google Developer Console"/></p>
<p>Now click on <strong>Credentials</strong> and <strong>Create New Key</strong> under the <strong>Public API Access</strong> heading.</p>
<p><img src="/images/blog/2014/03/Screenshot-from-2014-03-01-101615.png" alt="Create new PageSpeed Insights API"/></p>
<p>Create a <strong>Server Key</strong> and just click <strong>Create</strong> on the following page (i.e. leave the ‘Accept requests from there server IP addresses’ box empty). You’ll now have an API key you can use with the extension which will give you a personal request limit.</p>
<p><img src="/images/blog/2014/03/Screenshot-from-2014-03-01-102205.png" alt="Screenshot of Developer Console with Key"/></p>
<p>Just copy and paste the API Key into the extension options and you’ll be well away!</p>
<p><img src="/images/blog/2014/03/Screenshot-from-2014-03-01-102512.png" alt="PageSpeed Insights Chrome Extension Working"/></p>
<p>Orig. Photo: <a href="https://flic.kr/p/6YuriA">https://flic.kr/p/6YuriA</a></p>

</main>
<footer class="c-footer">
  <div class="c-footer__content">
    <a href="://twiter.com/gauntface">Twitter</a> | <a href="://github.com/gauntface">GitHub</a> | <a href="://www.linkedin.com/in/mattgaunt/">LinkedIn</a>
  </div>
</footer>
</div>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-155219449-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-155219449-1');
</script>

<script>var haCSS = haCSS || []; haCSS.push(...['/css/elements/code-async.css']);</script></body></html>