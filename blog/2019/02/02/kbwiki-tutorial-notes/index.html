<!DOCTYPE html><html lang="en"><head>
  <title>KBWiki Tutorial Notes</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="Description" content="This is the site description"/>
  <meta name="theme-color" content="#565797"/>
<style>h2{font-weight:400;font-size:1.7rem}</style><style>svg{display:block}</style><style>@import url("https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap");body{display:inline;min-height:100%;font-family:var(--body-font-family);background:var(--white);color:var(--dark-grey);margin:0}</style><style>.c-footer{display:flex;flex-direction:row;justify-content:center}.c-footer__content{padding:var(--footer-padding)}.c-footer a{text-decoration:none}</style><style>h3{font-weight:400;font-size:1.4rem}</style><style>.c-header{color:var(--platnum);padding:var(--header-padding) var(--page-padding);background:var(--dark-grey)}.c-header__logo svg{width:124px;height:124px;margin:auto}.c-header__logo svg path{fill:var(--white)}</style><style>img{max-width:100%;height:auto}</style><style>a{color:inherit}</style><style>p{word-wrap:break-word}</style><style>.l-default{display:flex;flex-direction:column;min-height:100%}.l-default__main{max-width:var(--page-max-width);margin:0 auto;flex:1;padding:var(--page-padding)}</style><style>h4{font-weight:400;font-size:1.2rem}</style><style>:root{--body-font-family:"Roboto",sans-serif;--code-font-family:"dm",monospace;--default-font-size:18px;--table-cell-padding:8px;--page-padding:24px;--header-padding:64px;--footer-padding:64px;--inline-code-padding:4px;--pre-padding:4px;--page-max-width:800px;--white:#f5f6fa;--dark-grey:#2f3640}html{height:100%;font-size:18px;font-size:var(--default-font-size)}</style></head><body>
<div class="l-default">
  <header class="c-header">
  <a href="/" class="c-header__logo">
    <svg width="1024" height="1024" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M988 36H36V987H988V36ZM0 0V1023H1024V0H0Z" fill="black"></path>
<path d="M834.787 519.358H767.661V590H746.567V430.039H845.664V447.397H767.661V502.109H834.787V519.358Z" fill="black"></path>
<path d="M574.089 447.397H522.673V590H501.689V447.397H450.383V430.039H574.089V447.397Z" fill="black"></path>
<path d="M834.984 821.062H765.661V877.751H846.19V895H744.567V735.039H845.092V752.397H765.661V803.813H834.984V821.062Z" fill="black"></path>
<path d="M575.23 844.243C573.253 861.162 566.991 874.236 556.444 883.464C545.97 892.62 532.018 897.197 514.586 897.197C495.689 897.197 480.528 890.422 469.103 876.873C457.75 863.323 452.074 845.195 452.074 822.49V807.109C452.074 792.241 454.71 779.167 459.984 767.888C465.331 756.609 472.875 747.966 482.616 741.96C492.357 735.881 503.636 732.842 516.454 732.842C533.446 732.842 547.069 737.603 557.323 747.124C567.577 756.572 573.546 769.683 575.23 786.455H554.027C552.196 773.711 548.204 764.482 542.052 758.77C535.973 753.057 527.44 750.2 516.454 750.2C502.977 750.2 492.394 755.181 484.703 765.142C477.086 775.103 473.277 789.275 473.277 807.659V823.149C473.277 840.508 476.903 854.314 484.154 864.568C491.405 874.822 501.549 879.949 514.586 879.949C526.305 879.949 535.277 877.312 541.502 872.039C547.801 866.692 551.976 857.427 554.027 844.243H575.23Z" fill="black"></path>
<path d="M266.397 853.252H199.38L184.329 895H162.576L223.66 735.039H242.117L303.311 895H281.668L266.397 853.252ZM205.752 835.894H260.135L232.889 761.077L205.752 835.894Z" fill="black"></path>
<path d="M294.004 590H272.8L192.271 466.733V590H171.067V430.039H192.271L273.02 553.855V430.039H294.004V590Z" fill="black"></path>
<path d="M848.177 122.039V230.804C848.104 245.892 843.343 258.233 833.895 267.828C824.52 277.422 811.775 282.806 795.662 283.978L790.059 284.197C772.554 284.197 758.602 279.473 748.201 270.025C737.801 260.577 732.527 247.576 732.381 231.023V122.039H753.255V230.364C753.255 241.937 756.441 250.945 762.813 257.391C769.185 263.763 778.267 266.949 790.059 266.949C801.998 266.949 811.116 263.763 817.415 257.391C823.787 251.019 826.973 242.046 826.973 230.474V122.039H848.177Z" fill="black"></path>
<path d="M545.897 240.252H478.88L463.829 282H442.076L503.16 122.039H521.617L582.811 282H561.168L545.897 240.252ZM485.252 222.894H539.635L512.389 148.077L485.252 222.894Z" fill="black"></path>
<path d="M292.17 261.016C286.75 268.78 279.169 274.603 269.428 278.484C259.76 282.293 248.481 284.197 235.59 284.197C222.553 284.197 210.981 281.158 200.874 275.079C190.766 268.926 182.929 260.21 177.363 248.931C171.87 237.652 169.05 224.578 168.903 209.71V195.757C168.903 171.661 174.506 152.984 185.712 139.727C196.992 126.47 212.812 119.842 233.173 119.842C249.873 119.842 263.312 124.126 273.493 132.696C283.674 141.192 289.899 153.277 292.17 168.951H271.076C267.121 147.784 254.523 137.2 233.283 137.2C219.147 137.2 208.417 142.181 201.093 152.142C193.842 162.029 190.18 176.385 190.107 195.208V208.282C190.107 226.226 194.208 240.508 202.412 251.128C210.615 261.675 221.711 266.949 235.7 266.949C243.61 266.949 250.532 266.07 256.464 264.312C262.397 262.554 267.304 259.588 271.186 255.413V219.488H234.162V202.349H292.17V261.016Z" fill="black"></path>
</svg>

  </a>
</header>
  <main class="l-default__main">
<p><img src="/images/blog/2019/2019-02-02/bw-circuit.jpg" alt="“Key art image for KBWiki Tutorial Notes blog post”"/></p>
<p>These are my notes from running through the
<a href="https://kbwiki.ai03.me/books/pcb-design">kbwiki tutorial / guide</a> for
making a custom keyboard.</p>
<p>First few sections is largely getting familiar with GitHub and KiCad.</p>
<h2 id="pcb-guide-3">PCB Guide 3</h2>
<p>Wondering the the position of the +5V over the UVCC pin and chaining
with two join points has any benefit over placing the +5V over VCC.
I assume it makes no difference as this is just a schematic view.</p>
<p>The HWB pin seems to be used to run the bootloader after a reset under
certain conditions, otherwise it acts as a general purpose I/O. You
can find more on the
<a href="http://ww1.microchip.com/downloads/en/devicedoc/atmel-7766-8-bit-avr-atmega16u4-32u4_datasheet.pdf">datasheet</a>
and searching for HWB.</p>
<h3 id="what-is-a-pull-updown-resistor">What is a Pull-Up/Down Resistor</h3>
<p>I looked up a few posts on this, but this YouTube video helped
the most.</p>
<!-- raw HTML omitted -->
<p>Below are some notes I toke from the video, but it&#39;s the same content.</p>
<p>In digital circuits there are three states, not two.</p>
<p>On, off and floating.</p>
<p>Floating can be an issue for circuits where trapped current can cause
the circuit to oscillate.</p>
<h4 id="pull-up-resistor">Pull-Up Resistor</h4>
<p>In a pull-up resistor configuration, the MCU pin is pulled up to 5V
by default. The reason the resistor is needed is because in the pull-up
resistor configuration, you don&#39;t want to connect the 5V directly to
ground as this will just drain the power source (a.k.a a short circuit).</p>
<p>Also worth noting that in a pull-up resister configuration, the current
will go to ground instead of the MCU because there is less / no impedence going to ground.</p>
<p>Pull-up resistors are normally built into the MCU.</p>
<h4 id="pull-down-resistor">Pull-Down Resistor</h4>
<p>This configuration pulls the MCU pin down to GND. When 5V is connected, the resistor will provide enough impedence to GND that the current will go through the MCU pin.</p>
<p>You should select a resistor that is 10 X the impedence of the input pin.</p>
<p>Pull-Down normally needs to be built outside of the MCU.</p>
<h3 id="why-hwb--pe2-to-pull-down">Why HWB / PE2 to Pull-Down?</h3>
<p>Based on the logic table from the <a href="http://ww1.microchip.com/downloads/en/devicedoc/atmel-7766-8-bit-avr-atmega16u4-32u4_datasheet.pdf">datasheet</a>, it seems like you rarely want this pin to be high.</p>
<p>Also looking at the “27.5.3 External Hardware conditions” section,
it seems that when this pin is zero after a reset, it will force the
bootloader to execute.</p>
<h3 id="why-10k-ohm">Why 10k Ohm?</h3>
<p>I can&#39;t really see what this is value is coming from for the pull down
resistor value.</p>
<p>The datasheet makes a reference of 10k Ohm or less:</p>
<blockquote>
<p>The ADC is optimized for analog signals with an output
impedance of approximately 10k or less</p>
</blockquote>
<p>But I don&#39;t think this applies here.</p>
<p>I considered that this value was perhaps taken from the teensy board
as a reference, but that&#39;s using a 1K ohm resistor.</p>
<h3 id="usb-resistors">USB Resistors</h3>
<p>The USB Resistors are given 22 Ohm resistors and this matches the
teensy board resistors.</p>
<p>Looking at the datasheet for this, it&#39;s clearly stated:</p>
<blockquote>
<p>Should be connected to the USB D+ connector pin
with a serial 22 ohm resistor.</p>
</blockquote>
<h3 id="ucap-capacitor">UCAP Capacitor</h3>
<p>Similar to the USB resistors, the values come from the datasheet.</p>
<blockquote>
<p>Should be connected to an external capacitor (1µF)</p>
</blockquote>
<h3 id="decoupling-capacitors">Decoupling Capacitors</h3>
<p>Taken from <a href="https://www.avrfreaks.net/forum/which-decoupling-caps-atmega32u4">AVR Freaks Blog Post</a>:</p>
<blockquote>
<p>There are three rues of thumb:</p>
<ol>
<li>
<p>100nF (0.1uF) ceramic for decoupling integrated circuits.<br/>
Especially digital switching. Short leads have lowest
self-inductance</p>
</li>
<li>
<p>10uF - 470uF electrolytic or Tantalum for “current reservoir”
in power supplies. Leads are less critical.
High currents may need special quality.</p>
</li>
<li>
<p>22pF for crystal oscillator circuits.</p>
</li>
</ol>
</blockquote>
<p>While this is far from official, it seems like like the 0.1uF is a
common practice and the 10uF is part of the above guidelines, but more
importantly is referenced in the datasheet:</p>
<blockquote>
<p>A 10µF capacitor is highly recommended on VBUS line</p>
</blockquote>
<p>This YouTube video was extremely helpful for learning <em>how</em> a decoupling
circuit works / what it does.</p>
<!-- raw HTML omitted -->
<p>The capacatiors provide charge to the MCU pins, preventing the need
to get the charge from the 5V line.</p>
<p>Secondly, should the pin discharge current, the low impedence of the
capacitor means the charge will go through the capactiors to GND, rather
than go to other pins.</p>
<h3 id="crystal-oscillator">Crystal (Oscillator)</h3>
<p>The tutorial references a “crystal” that controls how fast the
controller functions.</p>
<p>I believe it&#39;s referencing a <a href="https://en.wikipedia.org/wiki/Crystal_oscillator">Crystal Oscillator</a> which is a circuit
that creates an electrical signal with a precise frequency.</p>
<p>The 22pF capacitors seem to be a standard used in Arduino. The
<a href="http://www.ecsxtal.com/store/pdf/hc_49us.pdf">datasheet for this kind of oscillator</a>
hints at 20pF for load capacitance.</p>
<h3 id="things-to-explore">Things to Explore….</h3>
<ol>
<li>
<p>Why are the capacitors needed in with the crystal ocillator?
There is a notion of phase related with the voltage applied to
the crystal and the capacitors help ensure a specific phase.</p>
<p>It&#39;s discussed in this <a href="https://electronics.stackexchange.com/questions/250608/crystal-oscillator-load-capacitance-again">Stackoverflow question</a>
but it&#39;s still a little over my head how this works.</p>
</li>
</ol>

</main>
<footer class="c-footer">
  <div class="c-footer__content">
    <a href="://twiter.com/gauntface">Twitter</a> | <a href="://github.com/gauntface">GitHub</a> | <a href="://www.linkedin.com/in/mattgaunt/">LinkedIn</a>
  </div>
</footer>
</div>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-155219449-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-155219449-1');
</script>

</body></html>