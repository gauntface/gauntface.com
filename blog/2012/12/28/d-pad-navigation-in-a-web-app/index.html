<!DOCTYPE html><html lang="en"><head>
  <title>D-Pad Navigation in a Web App</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="Description" content="This is the site description"/>
  <meta name="theme-color" content="#565797"/>
<style>.c-header{color:var(--platnum);padding:var(--header-padding) var(--page-padding);background:var(--dark-grey)}.c-header__logo svg{width:124px;height:124px;margin:auto}.c-header__logo svg path{fill:var(--white)}</style><style>a{color:inherit}</style><style>svg{display:block}</style><style>.c-footer{display:flex;flex-direction:row;justify-content:center}.c-footer__content{padding:var(--footer-padding)}.c-footer a{text-decoration:none}</style><style>h2{font-weight:400;font-size:1.7rem}</style><style>h3{font-weight:400;font-size:1.4rem}</style><style>.l-default{display:flex;flex-direction:column;min-height:100%}.l-default__main{max-width:var(--page-max-width);margin:0 auto;flex:1;padding:var(--page-padding)}</style><style>h1{font-weight:400;font-size:2rem}</style><style>@import url("https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap");body{display:inline;min-height:100%;font-family:var(--body-font-family);background:var(--white);color:var(--dark-grey);margin:0}</style><style>p{word-wrap:break-word}</style><style>pre{overflow-x:auto}</style><style>pre{background-color:var(--dark-grey);padding:var(--pre-padding);border-radius:var(--pre-padding);overflow-x:auto;box-shadow:0 2px 8px var(--drop-shadow)}pre code{padding:0;background:unset}</style><style>img{max-width:100%;height:auto}</style><style>:root{--body-font-family:"Roboto",sans-serif;--code-font-family:"dm",monospace;--default-font-size:18px;--table-cell-padding:8px;--page-padding:24px;--header-padding:64px;--footer-padding:64px;--inline-code-padding:4px;--pre-padding:4px;--page-max-width:800px;--white:#f5f6fa;--dark-grey:#2f3640}html{height:100%;font-size:18px;font-size:var(--default-font-size)}</style><style>code{padding:0 var(--inline-code-padding);border-radius:var(--inline-code-padding);font-family:var(--code-font-family);background:var(--dark-grey);color:var(--white)}</style></head><body>
<div class="l-default">
  <header class="c-header">
  <a href="/" class="c-header__logo">
    <svg width="1024" height="1024" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M988 36H36V987H988V36ZM0 0V1023H1024V0H0Z" fill="black"></path>
<path d="M834.787 519.358H767.661V590H746.567V430.039H845.664V447.397H767.661V502.109H834.787V519.358Z" fill="black"></path>
<path d="M574.089 447.397H522.673V590H501.689V447.397H450.383V430.039H574.089V447.397Z" fill="black"></path>
<path d="M834.984 821.062H765.661V877.751H846.19V895H744.567V735.039H845.092V752.397H765.661V803.813H834.984V821.062Z" fill="black"></path>
<path d="M575.23 844.243C573.253 861.162 566.991 874.236 556.444 883.464C545.97 892.62 532.018 897.197 514.586 897.197C495.689 897.197 480.528 890.422 469.103 876.873C457.75 863.323 452.074 845.195 452.074 822.49V807.109C452.074 792.241 454.71 779.167 459.984 767.888C465.331 756.609 472.875 747.966 482.616 741.96C492.357 735.881 503.636 732.842 516.454 732.842C533.446 732.842 547.069 737.603 557.323 747.124C567.577 756.572 573.546 769.683 575.23 786.455H554.027C552.196 773.711 548.204 764.482 542.052 758.77C535.973 753.057 527.44 750.2 516.454 750.2C502.977 750.2 492.394 755.181 484.703 765.142C477.086 775.103 473.277 789.275 473.277 807.659V823.149C473.277 840.508 476.903 854.314 484.154 864.568C491.405 874.822 501.549 879.949 514.586 879.949C526.305 879.949 535.277 877.312 541.502 872.039C547.801 866.692 551.976 857.427 554.027 844.243H575.23Z" fill="black"></path>
<path d="M266.397 853.252H199.38L184.329 895H162.576L223.66 735.039H242.117L303.311 895H281.668L266.397 853.252ZM205.752 835.894H260.135L232.889 761.077L205.752 835.894Z" fill="black"></path>
<path d="M294.004 590H272.8L192.271 466.733V590H171.067V430.039H192.271L273.02 553.855V430.039H294.004V590Z" fill="black"></path>
<path d="M848.177 122.039V230.804C848.104 245.892 843.343 258.233 833.895 267.828C824.52 277.422 811.775 282.806 795.662 283.978L790.059 284.197C772.554 284.197 758.602 279.473 748.201 270.025C737.801 260.577 732.527 247.576 732.381 231.023V122.039H753.255V230.364C753.255 241.937 756.441 250.945 762.813 257.391C769.185 263.763 778.267 266.949 790.059 266.949C801.998 266.949 811.116 263.763 817.415 257.391C823.787 251.019 826.973 242.046 826.973 230.474V122.039H848.177Z" fill="black"></path>
<path d="M545.897 240.252H478.88L463.829 282H442.076L503.16 122.039H521.617L582.811 282H561.168L545.897 240.252ZM485.252 222.894H539.635L512.389 148.077L485.252 222.894Z" fill="black"></path>
<path d="M292.17 261.016C286.75 268.78 279.169 274.603 269.428 278.484C259.76 282.293 248.481 284.197 235.59 284.197C222.553 284.197 210.981 281.158 200.874 275.079C190.766 268.926 182.929 260.21 177.363 248.931C171.87 237.652 169.05 224.578 168.903 209.71V195.757C168.903 171.661 174.506 152.984 185.712 139.727C196.992 126.47 212.812 119.842 233.173 119.842C249.873 119.842 263.312 124.126 273.493 132.696C283.674 141.192 289.899 153.277 292.17 168.951H271.076C267.121 147.784 254.523 137.2 233.283 137.2C219.147 137.2 208.417 142.181 201.093 152.142C193.842 162.029 190.18 176.385 190.107 195.208V208.282C190.107 226.226 194.208 240.508 202.412 251.128C210.615 261.675 221.711 266.949 235.7 266.949C243.61 266.949 250.532 266.07 256.464 264.312C262.397 262.554 267.304 259.588 271.186 255.413V219.488H234.162V202.349H292.17V261.016Z" fill="black"></path>
</svg>

  </a>
</header>
  <main class="l-default__main">
<p><img src="/images/blog/2014/06/15/8386216143-d1f90d1204-o.jpg" alt="Key art for blog post “D-Pad Navigation in a Web App “"/></p>
<h1 id="d-pad-navigation-in-a-web-app">D-Pad Navigation in a Web App</h1>
<p><img src="/images/blog/2012/12/Web-App-D-Pad-Navigation.png" alt="Google TV Web App Native Sample"/></p>
<!-- raw HTML omitted -->
<p>Anyone developing an application for any platform should consider their UI from the outset, which relies heavily on understanding how people will interact with their app.</p>
<p>With Google TV and indeed many other TV platforms, the main mode of navigation is the humble and well established D-Pad.</p>
<p><img src="/images/blog/2012/12/Remote-D-Pads.png" alt="Remote D-Pads"/></p>
<p>The real question is, how can you make your website suitable for navigation via a D-Pad?</p>
<ol>
<li>Mike Hostetler&#39;s Keyboard Navigation Plugin for jQuery - <a href="https://github.com/mikehostetler/jquery-keynav">https://github.com/mikehostetler/jquery-keynav</a></li>
</ol>
<pre><code>* This is really helpful to get going but can have some limitations for complex UI&#39;s
</code></pre>
<ol start="2">
<li>Role your own solution</li>
</ol>
<pre><code>* This is one hell of a leap from the first option, but I ended up taking this approach for a recent piece of sample code - [https://code.google.com/p/googletv-android-samples/](https://code.google.com/p/googletv-android-samples/source/browse/#git%2FWebAppNativePlayback%253Fstate%253Dclosed)
</code></pre>
<p>When creating a sample application to demonstrate how to communicate between a WebView and a native application. I used the original Google TV template and then altered it and part of the changes made, was to switch the way focusing was handled.</p>
<h2 id="role-your-own-solution---one-approach">Role Your Own Solution - One Approach</h2>
<p>The approach taken was to have a controller class which would handle where the focus was and where it moved to when certain keys were pressed.</p>
<h3 id="focuscontrollerjs">FocusController.js</h3>
<p>On instantiating the class, a method would bind the keyevents to the method <code>onKeyDown()</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * focusController.js
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * This controller will take care of determining where the focus moves when
</span><span style="color:#75715e"> * a key press or mouse movement has occurred
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @constructor
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">FocusController</span>() {
    ...

    <span style="color:#75715e">// Set up binding to listen for key presses
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>(document).<span style="color:#a6e22e">bind</span>(<span style="color:#e6db74">&#39;keydown.keycontroller&#39;</span>,
        <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">e</span>) {
            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onKeyDown</span>(<span style="color:#a6e22e">e</span>);
        }.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">this</span>)
    );

    ...
}
</code></pre></div><p>The <code>onKeyDown()</code> method would then parse the keys and perform the relevant action (either move focus or handle the enter key).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">/**
</span><span style="color:#75715e">* focusController.js
</span><span style="color:#75715e">*
</span><span style="color:#75715e">* On a key press this method will handle moving the focus
</span><span style="color:#75715e">* @function
</span><span style="color:#75715e">* @param {int} event Browser key code
</span><span style="color:#75715e">*/</span>
<span style="color:#a6e22e">FocusController</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">onKeyDown</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">event</span>) {
  <span style="color:#66d9ef">switch</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">keyCode</span>) {
    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">9</span><span style="color:#f92672">:</span>
      <span style="color:#75715e">// Tab
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">37</span><span style="color:#f92672">:</span>
      <span style="color:#75715e">// Left
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">moveFocus</span>({<span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>});
      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">38</span><span style="color:#f92672">:</span>
      <span style="color:#75715e">// Up
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">moveFocus</span>({<span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>});
      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">39</span><span style="color:#f92672">:</span>
      <span style="color:#75715e">// Right
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">moveFocus</span>({<span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>});
      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">40</span><span style="color:#f92672">:</span>
      <span style="color:#75715e">// Down
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">moveFocus</span>({<span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>});
      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">13</span><span style="color:#f92672">:</span>
      <span style="color:#75715e">// Enter
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getCurrentlyFocusedItem</span>()) {
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getCurrentlyFocusedItem</span>().<span style="color:#a6e22e">onItemClick</span>();
      }
      <span style="color:#66d9ef">break</span>;
  }
};
</code></pre></div><p><code>moveFocus()</code> is a fairly simple method. Given the current focused item, find the element nearest to it, in the correct direction, which is done by comparing center points between each item.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">/**
</span><span style="color:#75715e">* focusController.js
</span><span style="color:#75715e">*
</span><span style="color:#75715e">* This will take a direction vector and move the focus to the most
</span><span style="color:#75715e">* appropriate item or make no change if there are no items to move to
</span><span style="color:#75715e">* @param {array} direction A direction vector [x, y]
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">moveFocus</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">direction</span>) {
    <span style="color:#75715e">// We need an item to move down from
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// TODO: Should initialise focus if not initialised
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">currentlyFocusedItem</span>) {
        <span style="color:#66d9ef">return</span>;
    }

    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">minItemDistance</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">newItem</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">minItem</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">minItemIndex</span>;
    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">focusableItems</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
        <span style="color:#a6e22e">newItem</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">focusableItems</span>[<span style="color:#a6e22e">i</span>];
        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">newItem</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">currentlyFocusedItem</span>) {
            <span style="color:#66d9ef">continue</span>;
        }

        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itemDistance</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">calculateElementDistance</span>(<span style="color:#a6e22e">currentlyFocusedItem</span>, <span style="color:#a6e22e">newItem</span>, <span style="color:#a6e22e">direction</span>);
        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">itemDistance</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">minItemDistance</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span> <span style="color:#f92672">||</span>
            <span style="color:#a6e22e">itemDistance</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">minItemDistance</span>)) {
            <span style="color:#a6e22e">minItemDistance</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">itemDistance</span>;
            <span style="color:#a6e22e">minItem</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newItem</span>;
            <span style="color:#a6e22e">minItemIndex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span>;
        }
    }

    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">minItemIndex</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">handleFocusChangeToItem</span>(<span style="color:#a6e22e">minItemIndex</span>);
    }
};
</code></pre></div><p>As you can see, when a new item is found, the <code>handleFocusChangeToItem()</code> method is called, which switches the focus state accordingly.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">/**
</span><span style="color:#75715e">* focusController.js
</span><span style="color:#75715e">*
</span><span style="color:#75715e">* This method performs a change of focus to the item index
</span><span style="color:#75715e">* @param {int} itemIndex
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">handleFocusChangeToItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">itemIndex</span>) {
    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">currentlyFocusedItem</span>) {
        <span style="color:#a6e22e">currentlyFocusedItem</span>.<span style="color:#a6e22e">setFocusState</span>(<span style="color:#66d9ef">false</span>);
    }

    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">focusableItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getFocusableItem</span>(<span style="color:#a6e22e">itemIndex</span>);
    <span style="color:#a6e22e">focusableItem</span>.<span style="color:#a6e22e">setFocusState</span>(<span style="color:#66d9ef">true</span>);

    <span style="color:#a6e22e">currentlyFocusedItem</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">focusableItem</span>;
};
</code></pre></div><p>The items considered for gaining focus are maintained in a list via two methods for adding and removing focusable items. The add method has a little extra source which manages mouse events occurring on the element.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// focusController.js
</span><span style="color:#75715e"></span>...

    <span style="color:#75715e">/**
</span><span style="color:#75715e">    * Remove a focusable item from the controller
</span><span style="color:#75715e">    * @param {FocusableItem} item The item to remove
</span><span style="color:#75715e">    */</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">removeFocusableItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">item</span>) {
      <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">focusableItems</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">focusableItems</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">==</span> <span style="color:#a6e22e">item</span>) {
          <span style="color:#a6e22e">focusableItems</span>.<span style="color:#a6e22e">splice</span>(<span style="color:#a6e22e">i</span>, <span style="color:#ae81ff">1</span>);
          <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
        }
      }
      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
    };

...

<span style="color:#75715e">/**
</span><span style="color:#75715e">* This method will add a focusable item to the controller
</span><span style="color:#75715e">* @function
</span><span style="color:#75715e">* @param {FocusableItem} item Focusable item to be handled by this
</span><span style="color:#75715e">* FocusController
</span><span style="color:#75715e">*/</span>
<span style="color:#a6e22e">FocusController</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">addFocusableItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">item</span>) {
  <span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">isFocusableItem</span>(<span style="color:#a6e22e">item</span>)) {
    <span style="color:#66d9ef">return</span>;
  }

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itemIndex</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getFocusableItemCount</span>();
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pushFocusableItem</span>(<span style="color:#a6e22e">item</span>);

  <span style="color:#75715e">// This is essentially the dom element of the focusable item
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">element</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">getElement</span>();
  <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">bind</span>(<span style="color:#e6db74">&#39;mouseenter.keycontroller&#39;</span>, {<span style="color:#a6e22e">itemIndex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">itemIndex</span>}, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">event</span>) {
    <span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">isMoving</span>()) {
        <span style="color:#66d9ef">return</span>;
    }

    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itemIndex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">itemIndex</span>;
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">handleFocusChangeToItem</span>(<span style="color:#a6e22e">itemIndex</span>);

    <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">stopPropagation</span>();
  }.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">this</span>));

  <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">bind</span>(<span style="color:#e6db74">&#39;click.keycontroller&#39;</span>, {<span style="color:#a6e22e">itemIndex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">itemIndex</span>}, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">event</span>) {
    <span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">isMoving</span>()) {
        <span style="color:#66d9ef">return</span>;
    }

    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itemIndex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">itemIndex</span>;
    <span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getCurrentlyFocusedItem</span>()) {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getCurrentlyFocusedItem</span>().<span style="color:#a6e22e">onItemClick</span>();
    }
  }.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">this</span>));
};
</code></pre></div><h3 id="focusableitemjs">FocusableItem.js</h3>
<p>This is a good point to introduce the FocusableItem class. This is intended to act as an interface which the FocusController can use to call the relevant methods on an item.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// FocusableItem.js
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Copyright 2012 Google Inc. All Rights Reserved.
</span><span style="color:#75715e"></span><span style="color:#75715e">//
</span><span style="color:#75715e"></span><span style="color:#75715e">// Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span><span style="color:#75715e"></span><span style="color:#75715e">// you may not use this file except in compliance with the License.
</span><span style="color:#75715e"></span><span style="color:#75715e">// You may obtain a copy of the License at
</span><span style="color:#75715e"></span><span style="color:#75715e">//
</span><span style="color:#75715e"></span><span style="color:#75715e">//      http://www.apache.org/licenses/LICENSE-2.0
</span><span style="color:#75715e"></span><span style="color:#75715e">//
</span><span style="color:#75715e"></span><span style="color:#75715e">// Unless required by applicable law or agreed to in writing, software
</span><span style="color:#75715e"></span><span style="color:#75715e">// distributed under the License is distributed on an &#34;AS-IS&#34; BASIS,
</span><span style="color:#75715e"></span><span style="color:#75715e">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span style="color:#75715e"></span><span style="color:#75715e">// See the License for the specific language governing permissions and
</span><span style="color:#75715e"></span><span style="color:#75715e">// limitations under the License.
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/**
</span><span style="color:#75715e"> * This class is intended to be inherited by all classes which are going to
</span><span style="color:#75715e"> * handle focusing on elements
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @constructor
</span><span style="color:#75715e"> * @param {DOMElement} domElement The dom element to assosciate with this
</span><span style="color:#75715e"> * focusable item
</span><span style="color:#75715e"> */</span>
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">FocusableItem</span>(<span style="color:#a6e22e">domElement</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">element</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">domElement</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">focusState</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;

  <span style="color:#75715e">/**
</span><span style="color:#75715e">  * Get the focusable DOM element
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getElement</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">element</span>;
  };

  <span style="color:#75715e">/**
</span><span style="color:#75715e">  * Set the focus state of this item
</span><span style="color:#75715e">  * @param {Boolean} isFocused
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setFocusState</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">focus</span>) {
    <span style="color:#a6e22e">focusState</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">focus</span>;
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onFocusStateChange</span>(<span style="color:#a6e22e">focus</span>);
  };
}

<span style="color:#75715e">/**
</span><span style="color:#75715e">* This is a callback method when the focus state has changed
</span><span style="color:#75715e">* @function
</span><span style="color:#75715e">* @param {Boolean} isFocused
</span><span style="color:#75715e">*/</span>
<span style="color:#a6e22e">FocusableItem</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">onFocusStateChange</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">isFocused</span>) {
  <span style="color:#75715e">// NOOP
</span><span style="color:#75715e"></span>};

<span style="color:#75715e">/**
</span><span style="color:#75715e">* Callback for when the item is clicked
</span><span style="color:#75715e">* @function
</span><span style="color:#75715e">*/</span>
<span style="color:#a6e22e">FocusableItem</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">onItemClick</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">FocusableItem_onItemClick</span>() {
  <span style="color:#75715e">// NOOP
</span><span style="color:#75715e"></span>};
</code></pre></div><p>As you can see, it&#39;s a particularly thin interface and the main methods you need to implement are <code>onFocusStateChange</code> and <code>onItemClick</code>. An example implementation of these two methods can be seen below.</p>
<h3 id="gridfocusableitemjs">GridFocusableItem.js</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// GridFocusableItem.js
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Copyright 2012 Google Inc. All Rights Reserved.
</span><span style="color:#75715e"></span><span style="color:#75715e">//
</span><span style="color:#75715e"></span><span style="color:#75715e">// Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span><span style="color:#75715e"></span><span style="color:#75715e">// you may not use this file except in compliance with the License.
</span><span style="color:#75715e"></span><span style="color:#75715e">// You may obtain a copy of the License at
</span><span style="color:#75715e"></span><span style="color:#75715e">//
</span><span style="color:#75715e"></span><span style="color:#75715e">//      http://www.apache.org/licenses/LICENSE-2.0
</span><span style="color:#75715e"></span><span style="color:#75715e">//
</span><span style="color:#75715e"></span><span style="color:#75715e">// Unless required by applicable law or agreed to in writing, software
</span><span style="color:#75715e"></span><span style="color:#75715e">// distributed under the License is distributed on an &#34;AS-IS&#34; BASIS,
</span><span style="color:#75715e"></span><span style="color:#75715e">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span style="color:#75715e"></span><span style="color:#75715e">// See the License for the specific language governing permissions and
</span><span style="color:#75715e"></span><span style="color:#75715e">// limitations under the License.
</span><span style="color:#75715e"></span>
<span style="color:#a6e22e">GridFocusableItem</span>.<span style="color:#a6e22e">prototype</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FocusableItem</span>();

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * This is a Focusable Grid Item. It handles the focusing and defocusing of
</span><span style="color:#75715e"> * the video thumbnails.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @constructor
</span><span style="color:#75715e"> * @augments FocusableItem
</span><span style="color:#75715e"> * @param {DOMElement} element The DOM element of the Focusable Item
</span><span style="color:#75715e"> * @param {String} containerId Container ID of the Focusable item
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">GridFocusableItem</span>(<span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">contId</span>) {
  <span style="color:#a6e22e">FocusableItem</span>.<span style="color:#a6e22e">call</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">element</span>);

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">classStates</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">focused</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;grid-item-active&#34;</span>
  };
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itemClickCallback</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">containerId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">contId</span>;

  <span style="color:#75715e">/**
</span><span style="color:#75715e">  * Set&#39;s a callback method for when the item is clicked
</span><span style="color:#75715e">  * @param {function} callback
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setOnItemClickCallback</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">callback</span>) {
    <span style="color:#a6e22e">itemClickCallback</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">callback</span>;
  };

  <span style="color:#75715e">/**
</span><span style="color:#75715e">  * Get the item click callback
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getOnItemClickCallback</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">itemClickCallback</span>;
  };

  <span style="color:#75715e">/**
</span><span style="color:#75715e">  * This returns an object with class names associated to each state
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getClassStates</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">classStates</span>;
  };

  <span style="color:#75715e">/**
</span><span style="color:#75715e">  * This is the container ID of the focusable DOM element
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getContainerId</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">containerId</span>;
  };
}

<span style="color:#75715e">/**
</span><span style="color:#75715e">* Callback when the objects focus state changes
</span><span style="color:#75715e">* @param {Boolean} isFocused
</span><span style="color:#75715e">*/</span>
<span style="color:#a6e22e">GridFocusableItem</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">onFocusStateChange</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">isFocused</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">element</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getElement</span>();
  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isFocused</span>) {
    <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">addClass</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getClassStates</span>().<span style="color:#a6e22e">focused</span>);

    <span style="color:#75715e">// Scroll into view
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itemRootParent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#&#34;</span><span style="color:#f92672">+</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getContainerId</span>());
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">elementWrapper</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">parent</span>();

    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">offsetAmount</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">elementWrapper</span>.<span style="color:#a6e22e">position</span>().<span style="color:#a6e22e">top</span> <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">elementWrapper</span>.<span style="color:#a6e22e">outerHeight</span>(<span style="color:#66d9ef">true</span>) <span style="color:#f92672">-</span>
    <span style="color:#a6e22e">itemRootParent</span>.<span style="color:#a6e22e">outerHeight</span>(<span style="color:#66d9ef">true</span>);

    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">offsetAmount</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#a6e22e">itemRootParent</span>.<span style="color:#a6e22e">stop</span>().<span style="color:#a6e22e">animate</span>({
        <span style="color:#a6e22e">scrollTop</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">itemRootParent</span>.<span style="color:#a6e22e">scrollTop</span>() <span style="color:#f92672">+</span> <span style="color:#a6e22e">offsetAmount</span>
      }, <span style="color:#ae81ff">500</span>);
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">elementWrapper</span>.<span style="color:#a6e22e">position</span>().<span style="color:#a6e22e">top</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#a6e22e">itemRootParent</span>.<span style="color:#a6e22e">stop</span>().<span style="color:#a6e22e">animate</span>({
        <span style="color:#a6e22e">scrollTop</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">itemRootParent</span>.<span style="color:#a6e22e">scrollTop</span>() <span style="color:#f92672">+</span> <span style="color:#a6e22e">elementWrapper</span>.<span style="color:#a6e22e">position</span>().<span style="color:#a6e22e">top</span>
      }, <span style="color:#ae81ff">500</span>);
    }
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">removeClass</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getClassStates</span>().<span style="color:#a6e22e">focused</span>);
  }
};

<span style="color:#75715e">/**
</span><span style="color:#75715e">* Callback when the object is clicked
</span><span style="color:#75715e">*/</span>
<span style="color:#a6e22e">GridFocusableItem</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">onItemClick</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getOnItemClickCallback</span>()) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getOnItemClickCallback</span>()();
  }
};
</code></pre></div><p>You can see how the GridFocusableItem class reacts to calls to <code>onFocusStateChange()</code> and <code>onItemClick()</code>.</p>
<p>In the <code>onFocusStateChange()</code> a class is added or removed to the DOM element, as well as scroll to the element within it&#39;s parent container. The <code>onItemClick()</code> simply executes a callback method.</p>
<h2 id="a-step-back">A Step Back</h2>
<p>To bring things back into perspective, the best way to think of this is to think of a FocusableItem as nothing more than a wrapper class around a DOM element, which makes it possible to have a controller manage the state of these items.</p>
<p>The way I use the FocusController for adding a removing items, is to have a controller class for each section of the UI and it&#39;s these classes which will add elements to the DOM tree as well as remove them and as they do, they will need to add or remove items from the FocusController.</p>
<h2 id="sum-up">Sum Up</h2>
<p>The main advantage of this approach is the amount of control you as a developer have through the numerous methods you can override. The drawback is that it requires more set-up and management.</p>
<p>The down sides to this implementation is that if you have a vast amount of elements in your UI, comparing every element for the closest one isn&#39;t efficient. There is also no checks on Z-index, this should be something which can be added into the FocusController, hopefully without too much trouble in the future.</p>
<p>If you want to see how this all fits together, look at index.js and see where the FocusController is instantiated and used.</p>
<p>What do you think? If you have a different approach, let me know, if you use this approach, let me know ;)</p>
<p>Orig. Photo: <a href="https://flic.kr/p/dM4xTv">https://flic.kr/p/dM4xTv</a></p>

</main>
<footer class="c-footer">
  <div class="c-footer__content">
    <a href="://twiter.com/gauntface">Twitter</a> | <a href="://github.com/gauntface">GitHub</a> | <a href="://www.linkedin.com/in/mattgaunt/">LinkedIn</a>
  </div>
</footer>
</div>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-155219449-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-155219449-1');
</script>

<script>var haCSS = haCSS || []; haCSS.push(...['/css/elements/code-async.css']);</script></body></html>